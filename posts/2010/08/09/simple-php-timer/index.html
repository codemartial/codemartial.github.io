<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Simple PHP Timer, by Tahir Hashmi</title><meta name=description content><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=canonical href=https://tahirhashmi.com/posts/2010/08/09/simple-php-timer/><meta property="og:title" content="Simple PHP Timer"><meta property="og:description" content="I was just trying to profile an HTML page for performance bottle-necks. Iâ€™m trying to follow a top-down approach, wherein I start from the entry script, and find the block of code that takes the biggest chunk of time before digging deeper into that chunk.
At this stage, itâ€™s not feasible to drop in a full-blown profiling tool like xdebug because of the set-up overhead and amount of data it generates."><meta property="og:type" content="article"><meta property="og:url" content="https://tahirhashmi.com/posts/2010/08/09/simple-php-timer/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-08-09T12:23:45+00:00"><meta property="article:modified_time" content="2023-03-22T20:29:26+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Simple PHP Timer"><meta name=twitter:description content="I was just trying to profile an HTML page for performance bottle-necks. Iâ€™m trying to follow a top-down approach, wherein I start from the entry script, and find the block of code that takes the biggest chunk of time before digging deeper into that chunk.
At this stage, itâ€™s not feasible to drop in a full-blown profiling tool like xdebug because of the set-up overhead and amount of data it generates."><meta itemprop=name content="Simple PHP Timer"><meta itemprop=description content="I was just trying to profile an HTML page for performance bottle-necks. Iâ€™m trying to follow a top-down approach, wherein I start from the entry script, and find the block of code that takes the biggest chunk of time before digging deeper into that chunk.
At this stage, itâ€™s not feasible to drop in a full-blown profiling tool like xdebug because of the set-up overhead and amount of data it generates."><meta itemprop=datePublished content="2010-08-09T12:23:45+00:00"><meta itemprop=dateModified content="2023-03-22T20:29:26+07:00"><meta itemprop=wordCount content="301"><meta itemprop=keywords content="debugging,function,php,printf,script,timer,"><link rel=alternate type=application/rss+xml href=https://tahirhashmi.com/posts/index.xml title="Tahir Hashmi"><link rel=stylesheet href=/assets/css/main.min.b2c12bad96fd15efcbfc37e21ebae08ed0baea4b512e4f98b3ef63db6c6e8652.css media=all><link rel=preload as=font href=/fonts/Probert.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/ProbertBold.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/Oxanium.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/BerkeleyMonoVariable-Regular.woff2 type=font/woff2 crossorigin=anonymous><script defer src=/assets/js/main.min.35e33a864dbe04f338d5c5bb84090b1891b3f1dd3c2b651aa0317abcffc176b5.js></script></head><body class=page><div id=headline><h1>Simple PHP Timer</h1></div><div id=content><main><article><time datetime="2010-08-09 12:23:45 +0000 UTC" itemprop=datePublished>August 9, 2010</time><p>I was just trying to profile an HTML page for performance bottle-necks. Iâ€™m trying to follow a top-down approach, wherein I start from the entry script, and find the block of code that takes the biggest chunk of time before digging deeper into that chunk.</p><p>At this stage, itâ€™s not feasible to drop in a full-blown profiling tool like xdebug because of the set-up overhead and amount of data it generates. So, I wrote a simple timing function that you can call at various points in your program to provide incremental and cumulative timing info in milliseconds. Just call this function anywhere in your code with a message and itâ€™ll print that message to your PHP output, followed by millisecond timing information at that point. Hereâ€™s the function implementation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>time_this</span>($msg) {
</span></span><span style=display:flex><span>  $prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;[[&#39;</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>static</span> $start <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>static</span> $prev <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>   $now <span style=color:#f92672>=</span> <span style=color:#a6e22e>microtime</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> ($start <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      $start <span style=color:#f92672>=</span> $now;
</span></span><span style=display:flex><span>      $prev  <span style=color:#f92672>=</span> $now;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s%s: %f (cum), %f (incr)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, $prefix, $msg, ($now <span style=color:#f92672>-</span> $start)<span style=color:#f92672>*</span><span style=color:#ae81ff>1000.0</span>, ($now <span style=color:#f92672>-</span> $prev)<span style=color:#f92672>*</span><span style=color:#ae81ff>1000.0</span>);
</span></span><span style=display:flex><span>   $prev <span style=color:#f92672>=</span> $now;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>time_this</span>(<span style=color:#e6db74>&#34;&#34;</span>); <span style=color:#75715e>// initialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>The nice thing about this script is that it automatically keeps track of timing information through static variables. You donâ€™t need to keep track of that manually. Since itâ€™s also taking in a message, you could use it to debug your program if youâ€™re among those who find <code>printf</code> to be the best debugger ðŸ˜€</p><p>Sample usage:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;time_this.php&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>time_this</span>(<span style=color:#e6db74>&#34;starting script&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;foo.php&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;bar.php&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>time_this</span>(<span style=color:#e6db74>&#34;includes done&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>time_this</span>(<span style=color:#e6db74>&#34;somewhere in between&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>time_this</span>(<span style=color:#e6db74>&#34;script ends&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>[[</span>starting script: 0.000015 <span style=color:#f92672>(</span>cum<span style=color:#f92672>)</span>, 0.000015 <span style=color:#f92672>(</span>incr<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[[</span>includes <span style=color:#66d9ef>done</span>: 94.221115 <span style=color:#f92672>(</span>cum<span style=color:#f92672>)</span>, 94.221100 <span style=color:#f92672>(</span>incr<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[[</span>somewhere in between: 110.846996 <span style=color:#f92672>(</span>cum<span style=color:#f92672>)</span>, 16.625881 <span style=color:#f92672>(</span>incr<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[[</span>script ends: 145.432760 <span style=color:#f92672>(</span>cum<span style=color:#f92672>)</span>, 34.585764 <span style=color:#f92672>(</span>incr<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Let me know if you like it, or if you know of something similar that does the job better.</p></article><div style=display:flex;width:100%><div style=width:50%><p style=text-align:left>Previous Post:<br><a href=https://tahirhashmi.com/posts/2010/08/03/shooting-in-the-dark/>Shooting in the Dark</a></p></div><div style=width:50%><p style=text-align:right>Next Post:<br><a href=https://tahirhashmi.com/posts/2010/08/18/capturing-rain/>Capturing Rain</a></p></div></div></main></div><div id=sidebar><nav class=sidebar-nav><ul><li><a class=sidebar-nav-item href=/posts/ title=Articles>Articles</a></li><li><a class=sidebar-nav-item href=/about/ title=About>About</a></li><li><a class=sidebar-nav-item href=/photos/ title=Photos>Photos</a></li><li><a class=sidebar-nav-item href=/categories/opinion/ title=opinion>opinion</a></li><li><a class=sidebar-nav-item href=/categories/photography/ title=photography>photography</a></li><li><a class=sidebar-nav-item href=/categories/programming/ title=programming>programming</a></li><li><a class=sidebar-nav-item href=/categories/reviews/ title=reviews>reviews</a></li><li><a class=sidebar-nav-item href=/categories/technology/ title=technology>technology</a></li></ul><div id=fastSearch><span id=cursor><input id=searchInput tabindex=0 placeholder=search></span><ul id=searchResults></ul></div></nav></div><div id=section2><p><a href=https://tahirhashmi.com/posts/>Articles</a></p></div><div id=logo><a href=/><svg id="svgLogo" baseProfile="full" xmlns="https://www.w3.org/2000/svg" viewBox="0 0 400 100" preserveAspectRatio="xMidYMid"><radialGradient id="logoGradient"><stop offset="30%" stop-color="#00ff80"/><stop offset="67%" stop-color="#00c000"/><stop offset="100%" stop-color="#606000"/></radialGradient><polygon points="0, 67 160, 0 200, 100 240, 0 400, 67 240, 33 200, 67 160, 33" fill="url(#logoGradient)"/></svg></a></div><div id=space><p>Tahir Hashmi</p></div><footer id=footer>mail@tahirhashmi.com
| <a href=https://flickr.com/photos/code_martial/>Flickr</a>
| <a href=https://github.com/codemartial>Github</a>
| <a href=https://www.linkedin.com/in/tahirhashmi>LinkedIn</a>
| <a href=https://twitter.com/code_martial>Twitter</a>
| <a href=https://tahirhashmi.com/posts/index.xml type=.mediatype.type rel=.rel>RSS</a> | &copy; 2022 Tahir Hashmi. All rights reserved.</footer><div class=splash></div><div class=glow></div></body></html>