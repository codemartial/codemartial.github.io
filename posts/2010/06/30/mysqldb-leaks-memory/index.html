<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>MySQLdb Leaks Memory, by Tahir Hashmi</title><meta name=description content><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=canonical href=https://tahirhashmi.com/posts/2010/06/30/mysqldb-leaks-memory/><link rel=alternate type=application/rss+xml href=https://tahirhashmi.com/index.xml><meta property="og:title" content="MySQLdb Leaks Memory"><meta property="og:description" content="Whenever people search for a Python library for MySQL, they get directed to MySQL for Python. However, there are some nasties hidden in it. Searching for “mysql python memory leaks” results in a few links which suggest that using Unicode causes memory leaks with the library.
Today, however, I found another cause for MySQLdb memory leaks, while debugging a leaky Python daemon at work — database errors.
Use this script:"><meta property="og:type" content="article"><meta property="og:url" content="https://tahirhashmi.com/posts/2010/06/30/mysqldb-leaks-memory/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-06-30T11:32:30+00:00"><meta property="article:modified_time" content="2022-12-08T13:28:12+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MySQLdb Leaks Memory"><meta name=twitter:description content="Whenever people search for a Python library for MySQL, they get directed to MySQL for Python. However, there are some nasties hidden in it. Searching for “mysql python memory leaks” results in a few links which suggest that using Unicode causes memory leaks with the library.
Today, however, I found another cause for MySQLdb memory leaks, while debugging a leaky Python daemon at work — database errors.
Use this script:"><meta itemprop=name content="MySQLdb Leaks Memory"><meta itemprop=description content="Whenever people search for a Python library for MySQL, they get directed to MySQL for Python. However, there are some nasties hidden in it. Searching for “mysql python memory leaks” results in a few links which suggest that using Unicode causes memory leaks with the library.
Today, however, I found another cause for MySQLdb memory leaks, while debugging a leaky Python daemon at work — database errors.
Use this script:"><meta itemprop=datePublished content="2010-06-30T11:32:30+00:00"><meta itemprop=dateModified content="2022-12-08T13:28:12+07:00"><meta itemprop=wordCount content="203"><meta itemprop=keywords content="code,memory leak,mysql,mysqldb,programming,python,"><link rel=alternate type=application/rss+xml href=https://tahirhashmi.com/posts/2010/06/30/mysqldb-leaks-memory/index.xml title="Tahir Hashmi"><link rel=stylesheet href=/assets/css/main.min.734b05aefd7d7d4f6b874ce4bcf84bfed248a56090ac5eea34b8e3a78c883a8a.css media=all><link rel=preload as=font href=/fonts/Probert.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/ProbertBold.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/Oxanium.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/BerkeleyMonoVariable-Regular.woff2 type=font/woff2 crossorigin=anonymous><script defer src=/assets/js/main.min.35e33a864dbe04f338d5c5bb84090b1891b3f1dd3c2b651aa0317abcffc176b5.js></script></head><body class=page><div id=headline><h1>MySQLdb Leaks Memory</h1></div><div id=content><main><article><time datetime="2010-06-30 11:32:30 +0000 UTC" itemprop=datePublished>June 30, 2010</time><p>Whenever people search for a Python library for MySQL, they get directed to <a href=http://sourceforge.net/projects/mysql-python/ target=_blank>MySQL for Python</a>. However, there are some nasties hidden in it. Searching for “mysql python memory leaks” results in a few links which suggest that using Unicode causes memory leaks with the library.</p><p>Today, however, I found another cause for MySQLdb memory leaks, while debugging a leaky Python daemon at work — database errors.</p><p>Use this script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> MySQLdb
</span></span><span style=display:flex><span>options <span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>  </span> {
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;user&#34;</span>: <span style=color:#e6db74>&#34;user&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;passwd&#34;</span>: <span style=color:#e6db74>&#34;p455&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;db&#34;</span>: <span style=color:#e6db74>&#34;somedb&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;connect_timeout&#34;</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        MySQLdb<span style=color:#f92672>.</span>connect(<span style=color:#f92672>**</span>options)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> MySQLdb<span style=color:#f92672>.</span>Error:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span></code></pre></div><p>Make sure MySQL is up and it’s possible to connect to it without failures using the above credentials. Then run this script and watch its memory usage. It’ll be rock steady for as long as you care to run it.</p><p>Now stop <code>mysqld</code> or do anything that would cause errors during connection and rerun the script. Watch it gobble up meg after meg as the errors continue. Any MySQL error, like unreachable server, missing database or tables, malformed query, etc. would trigger the leak.</p><p><del>I need to check if the recently released (13 days ago) MySQLdb 1.2.3 does better in this regard.</del> MySQLdb 1.2.3 does fix the memory leak in this case.</p></article><div style=display:flex;width:100%><div style=width:50%><p style=text-align:left>Previous Post:<br><a href=https://tahirhashmi.com/posts/2010/06/18/hello-world/>{Browse ‘Hello World!’}</a></p></div><div style=width:50%><p style=text-align:right>Next Post:<br><a href=https://tahirhashmi.com/posts/2010/07/28/php-vs-python-for-web-apps/>PHP vs. Python for Web Apps</a></p></div></div></main></div><div id=sidebar><nav class=sidebar-nav><ul><li><a class=sidebar-nav-item href=/posts/ title=Articles>Articles</a></li><li><a class=sidebar-nav-item href=/about/ title=About>About</a></li><li><a class=sidebar-nav-item href=/photos/ title=Photos>Photos</a></li><li><a class=sidebar-nav-item href=/categories/opinion/ title=opinion>opinion</a></li><li><a class=sidebar-nav-item href=/categories/photography/ title=photography>photography</a></li><li><a class=sidebar-nav-item href=/categories/programming/ title=programming>programming</a></li><li><a class=sidebar-nav-item href=/categories/reviews/ title=reviews>reviews</a></li><li><a class=sidebar-nav-item href=/categories/technology/ title=technology>technology</a></li></ul><div id=fastSearch><span id=cursor><input id=searchInput tabindex=0 placeholder=search></span><ul id=searchResults></ul></div></nav></div><div id=section2><p><a href=https://tahirhashmi.com/posts/>Articles</a></p></div><div id=logo><a href=/><svg id="svgLogo" baseProfile="full" xmlns="https://www.w3.org/2000/svg" viewBox="0 0 400 100" preserveAspectRatio="xMidYMid"><radialGradient id="logoGradient"><stop offset="30%" stop-color="#00ff80"/><stop offset="67%" stop-color="#00c000"/><stop offset="100%" stop-color="#606000"/></radialGradient><polygon points="0, 67 160, 0 200, 100 240, 0 400, 67 240, 33 200, 67 160, 33" fill="url(#logoGradient)"/></svg></a></div><div id=space><p>Tahir Hashmi</p></div><footer id=footer>mail@tahirhashmi.com
| <a href=https://flickr.com/photos/code_martial/>Flickr</a>
| <a href=https://github.com/codemartial>Github</a>
| <a href=https://www.linkedin.com/in/tahirhashmi>LinkedIn</a>
| <a href=https://twitter.com/code_martial>Twitter</a>
| <a href=https://tahirhashmi.com/index.xml>RSS</a>
| &copy; 2022 Tahir Hashmi. All rights reserved.</footer><div class=splash></div><div class=glow></div></body></html>